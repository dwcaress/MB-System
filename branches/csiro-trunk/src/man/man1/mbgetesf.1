.TH mbgetesf 1 "3 June 2013" "MB-System 5.0" "MB-System 5.0"
.SH NAME
\fBmbgetesf\fP \- Extract swath bathymetry data flags into an edit save file.

.SH VERSION
Version 5.0

.SH SYNOPSIS
\fBmbgetesf\fP [\fB\-F\fPformat \fB\-I\fPinfile \fB\-M\fPmode \fB\-O\fPesffile \fB\-V \-H\fP]

.SH DESCRIPTION
Swath bathymetry data is typically edited either with interactive
tools such as \fBmbedit\fP or automatic filters such as \fBmbclean\fP.
The beams which are deemed "bad" are flagged, and the flags are
output to an "edit save file", which can be applied to data
later by \fBmbprocess\fP.
Occasionally, the need arises to translate data
flagging information from one file to another which represents a
different version of the same dataset.  In particular, it may happen
that editing has been done on a data format which does not support
all of the original data stream (e.g. the edmb Hydrosweep format 22,
which does not contain travel times or amplitudes), but the user now
wishes to work with the complete data stream without having to redo
the editing process.

The utility \fBmbgetesf\fP allows the user to extract
the flagging information in the form of an
"edit save file" like those generated by \fBmbedit\fP and
\fBmbclean\fP. These edits can be applied to data later
using \fBmbprocess\fP. If the edit save file is named
properly (an ".esf" suffix added to the input swath file
name), the edits can automatically be loaded into \fBmbedit\fP or
\fBmbclean\fP.

The user can extract edit events from only the flagged beams (\fB\-M\fP\fI1\fP),
or can extract edit events specifying null and flagged beams (\fB\-M\fP\fI2\fP),
or all (good, flagged, and null) beams (\fB\-M\fP\fI3\fP).
The \fB\-M\fP\fI2\fP and \fB\-M\fP\fI3\fP cases are useful if
previous editing has involved nulling beams that were
originally classified as good or unflagging beams that were
originally flagged.


The default input is from stdin, and the default output is
to standard out.

.SH MB-SYSTEM AUTHORSHIP
David W. Caress
.br
  Monterey Bay Aquarium Research Institute
.br
Dale N. Chayes
.br
  Center for Coastal and Ocean Mapping
.br
  University of New Hampshire
.br
Christian do Santos Ferreira
.br
  MARUM - Center for Marine Environmental Sciences
.br
  University of Bremen

.SH OPTIONS
.TP
.B \-F
\fIformat\fP
.br
Sets the format for the input and output swath data using
\fBMBIO\fP integer format identifiers.
These utilities uses the \fBMBIO\fP library and will read any swath data
format supported by \fBMBIO\fP. A list of the swath data formats
currently supported by \fBMBIO\fP and their identifier values
is given in the \fBMBIO\fP manual page.
.TP
.B \-H
This "help" flag causes the program to print out a description
of its operation and then exit immediately.
.TP
.B \-I
\fIinfile\fP
.br
Data file from which the input data will be read. If
no input file is specified, the input will be read
from stdin. Default: \fIinfile\fP = stdin.
.TP
.B \-M
\fImode\fP
.br
Specifies which beam flag values are output as edit events.
If \fImode\fP = 1, then only flagged beams are output. If
\fImode\fP = 2, then flagged and null beams are output. If
\fImode\fP = 3, then an edit event will be output for every
beam, including those that are "good" (neither flagged nor
null).
The \fImode\fP values of 4 to 6 cause the output "edit save file" to have an
embedded special mode that implicitly sets all beam flags not specified with
an edit event to a default value. If \fImode\fP=5 then the default value is
null, if \fImode\fP=6 then the default value is good, and if \fImode\fP=4 then
the default value is good for most formats and null for the few formats that
have more null than valid beams. The default modes are used by programs
\fBmbpreprocess\fP and \fBmbeditviz\fP when generating and using "global edit
files" ("*.gef" suffix) that are used to completely specify the beam flag state
of a raw swath bathymetry file.
Default: \fImode\fP = 1.
.TP
.B \-O
\fIesffile\fP
.br
Specifies output edit save file to which the
edit events will be written. If
no edit save file is specified, the output will be written
to stdout. Default: \fIesffile\fP = stdout.
.TP
.B \-V
Normally, \fBmbgetesf\fP works "silently" without outputting
anything to the stderr stream.  If the
\fB\-V\fP flag is given, then \fBmbgetesf\fP works in a "verbose" mode and
outputs the program version being used and all error status messages.

.SH EXAMPLES
Suppose one has an edmb format (\fBMBIO\fP format id 22) Hydrosweep
file called hs_ew9103_143.mb22 which has been edited using older
versions of \fBmbedit\fP so that no edit save file was generated.
Further suppose that one's thesis advisor
suggests that the bathymetry would be better if it were recalculated
from travel times using a new water velocity model, requiring that
the raw Hydrosweep data (originally collected in format 21 but
recently translated to format 24) in the file hs_ew9103_143.mb24
be used. First extract the edit events in the form of
a edit save file from the edited edmb file:
 	mbgetesf \-F22 \-Ihs_ew9103_143.mb22 \
 		-Ohs_ew9103_143.mb24.esf \-V
.br
Note that the edit save file has been given the name of the
second swath file with ".esf" appended. This naming convention
is the same as if \fBmbedit\fP or \fBmbclean\fP had been
run on hs_ew9103_143.mb24. Now, running either \fBmbedit\fP or \fBmbclean\fP
will automatically load the edit events as a starting point
for editing or filtering.
To simply apply the extracted edit events to the swath bathymetry,
first use \fBmbset\fP to enable applying the edits in the
\fBmbprocess\fP parameter file, and then run \fBmbprocess\fP
to actually apply the edits and generate a processed output
swath file:
 	mbset \-Ihs_ew9103_143.mb24 \
 		-PEDITSAVEMODE:1 \
 		-PEDITSAVEFILE:hs_ew9103_143.mb24.esf \
 		-V
 	mbprocess \-Ihs_ew9103_143.mb24 \-V
.br
The output swath file will be named hs_ew9103_143p.mb24.

.SH SEE ALSO
\fBmbsystem\fP(1), \fBmbedit\fP(1), \fBmbclean\fP(1),
\fBmbset\fP(1), \fBmbprocess\fP(1).

.SH BUGS
Let us know.
