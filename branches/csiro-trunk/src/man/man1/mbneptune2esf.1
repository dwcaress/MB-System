.TH mbneptune2esf 1 "3 June 2013" "MB-System 5.0" "MB-System 5.0"
.SH NAME
\fBmbneptune2esf\fP \- Tool to import beam flags from Simrad's Neptune system.

.SH VERSION
Version 5.0

.SH SYNOPSIS
\fBmbneptune2esf\fP [\fB\-F\fIformat\fP
\fB\-I\fIinfile\fP \fB\-O\fIoutfile\fP
\fB\-M\fImode\fP \fB\-R\fIrules_file\fP \fB\-V \-H\fP]

.SH DESCRIPTION
\fBmbneptune2esf\fP imports manual data flagging performed using Simrad's NEPTUNE
software and flags those beams in the corresponding MB-System files.

The \fBbinstat\fP tool in Simrad's NEPTUNE software has a number of advantages over mbedit
as a tool for flagging bad data, including access to a variety of statistics from gridding
the data. MB-System is generally more flexible and powerful in a number of other areas.
\fBmbneptune2esf\fP tries to give you the best of both worlds.

\fBmbneptune2esf\fP reads a binstat_?.rules file generated by manually cleaning
data using the correlation plot in the binstat tool of the neptune sofware
written by Kongsberg Simrad and writes these edits in a mbsystem esf file.
The purpose of this tool is to allow data cleaning done using neptune to
be carried into the mbsystem environment \- thus making neptune a more useful
tool.

\fBmbneptune2esf\fP applies all the manual edits in the rules file given to those
of the input files it recognises as matching the original lines.
A line is considered to match if the line name contained in the rules file
(e.g. 0002_20000408_221415) is part of the file name of the data file
(e.g. 0002_20000408_221415.mb57).

Swath line files should be converted to format 57 using mbcopy before
using this program, as format 56 does not have the ability to flag data
(although data can be zeroed \- but zero may be a valid depth).

Data flagged by rules generated in binstat is not flagged by this program \-
only manually flagged data is flagged.

\fBmbneptune2esf\fP can also be used to transfer processing done in neptune to other surveys.
Neptune breaks a survey up into a number of blocks and records all the
processing done in these blocks. Changing a block results in a loss of
all the existing processing information. When adding data to an existing
survey that falls outside any existing block, all of the existing blocks
must be removed, and therefore all of the processing is lost.
\fBmbneptune2esf\fP and \fBmbprocess\fP
can be used to zero all the beams flagged during neptune processing and
the processed files can then be used as the basis for a new survey, preserving
the manual flagging (but losing the flagged data).
The zero data can then be easily flagged in neptune.

 	cd $RAWDATAHOME
 	ls *raw.all | while (read file) ; do
 			echo $file 56 1 >> datalist.mb-1
 		done
 	cat $PROCHOME/old_survey/binstat_*.rules | mbneptune2esf \-m3
 	mbprocess
 	cat *p.mb56 | handleEmX new_survey op

This program flags beams by outputting the flags as
edit events to an "edit save file", like that produced
by \fBmbedit\fP. If an "edit save file" (named by adding
a ".esf" suffix to the input swath filename) already
exists, the edits are read in and applied before the
\fBmbneptune2esf\fP flagging algorithms are used.
Once generated, the edit events can be applied
to the data using the program \fBmbprocess\fP, which
outputs a processed swath data file.
The \fBmbprocess\fP program is also used to merge
edited navigation, recalculate bathymetry, and apply
other corrections to swath bathymetry data.

.SH AUTHORSHIP
Gordon Keith (gordon.keith@csiro.au)
.br
  CSIRO Australia
.br
David W. Caress (caress@mbari.org)
.br
  Monterey Bay Aquarium Research Institute
.br
Dale N. Chayes (dale@ldeo.columbia.edu)
.br
  Lamont-Doherty Earth Observatory

.SH OPTIONS
.TP
.B \-F
\fIformat\fP
.br
Sets the data format used if the input is read from stdin
or from a file. If \fIformat\fP < 0, then the input file specified
with the \fB\-I\fP option will actually contain a list of input swath sonar
data files. This program uses the \fBMBIO\fP library
and will read or write any swath sonar
format supported by \fBMBIO\fP. A list of the swath sonar data formats
currently supported by \fBMBIO\fP and their identifier values
is given in the \fBMBIO\fP manual page. Default: \fIformat\fP = 11.
Only formats 56 and 57 files are affected by this program. Other files are
ignored.
.TP
.B \-H
This "help" flag cause the program to print out a description
of its operation and then exit immediately.
.TP
.B \-I
\fIinfile\fP
.br
Sets the input filename. If \fIformat\fP > 0 (set with the
\fB\-F\fP option) then the swath sonar data contained in \fIinfile\fP
is read and processed. If \fIformat\fP < 0, then \fIinfile\fP
is assumed to be an ascii file containing a list of the input swath sonar
data files to be processed and their formats.  The program will read
and process the data in each one of these files. Each input file will
have an associated output file with the ".esf" suffix.
In the \fIinfile\fP file, each
data file should be followed by a data format identifier, e.g.:
 	datafile1 11
 	datafile2 24
.br
This program uses the \fBMBIO\fP library and will read or write any swath sonar
format supported by \fBMBIO\fP. A list of the swath sonar data formats
currently supported by \fBMBIO\fP and their identifier values
is given in the \fBMBIO\fP manual page.
Only formats 56 and 57 files are affected by this program. Other files are ignored.
Default: \fIinfile\fP = "datalist.mb-1".
.TP
.B \-M
\fImode\fP
.br
Sets the manner in which flagged by neptune are handled.
 	\fImode\fP = 1:	Flags the flagged beam.
 	\fImode\fP = 3:	Zeros the flagged beam.
Default: \fImode\fP = 1.
.TP
.B \-O
\fIoutfile\fP
.br
Specifies a file to write a copy of the beam information extracted from the
rules file. Mostly for debugging purposes.
.TP
.B \-R
\fIrules_file\fP
.br
The binstat rules file containing the manual flagging rules to be
applied. Rules files are normally $PROCHOME/\fIsurvey\fP/binstat_\fIblock\fP.rules.
The LINES_PING_BEAM_RULE rules from this file will be applied to the
matching line(s) in the input file.
Default: \fIrules_file\fP = stdin.
.TP
.B \-V
Normally, \fBmbneptune2esf\fP works "silently" without outputting
anything to the stderr stream.  If the
\fB\-V\fP flag is given, then \fBmbneptune2esf\fP works in a "verbose" mode and
outputs the program version being used, all error status messages,
and the number of beams flagged as bad.

.SH EXAMPLES

The normal use of \fBmbneptune2esf\fP would be to apply all the manual edits
in a Neptune survey to the coresponding MB-System survey represented by a
datalist:

	cat $PROCHOME/Broken_Reef/binstat_*.rules | \\
 		mbneptune2esf \-I/data/mbproc/Broken_Reef/datalist.mb-1

Since the default input file is the datalist in the current directory,
the following is equivalent if the Neptune environment variable PROCHOME
evaluates to /data/proc:

 	cd /data/mbproc/Broken_Reef
 	cat /data/proc/Broken_Reef/binstat_*.rules | mbneptune2esf

To apply the manual edits from a particular block of a Neptune survey
to only one of the related data files:

 	mbneptune2esf \-R $PROCHOME/Broken_Reef/binstat_1.rules \\
 		-F57 \-I0032_20000408_221201.mb57

To use the manual edits from a particular block of a Neptune survey
to zero the beams of one of the related data files:

 	mbneptune2esf \-R $PROCHOME/Broken_Reef/binstat_2.rules
 		-M3  \-F56 \-I0002_20000408_153940_raw.all

.SH SEE ALSO
\fBmbsystem\fP(1), \fBmbclean\fP(1), \fBmbedit\fP(1),
\fBmbprocess\fP(1)

.SH BUGS
\fBmbneptune2esf\fP does not flag beams flagged by rules in binstat,
only beams that are flagged manually using the correlation plot.

Probably plenty of others.
