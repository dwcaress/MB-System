
# README-mbtrn

## About mbtrnpp-plot and trnucli-plot

TRN Performance metrics generated by mbtrnpp and trnuctx may be plotted using mbtrnpp-plot.sh and trnucli-plot.sh.
Each produces a series of PNG plot images, combined into a single PDF document.

These utilities are wrappers a suite of (bash) scripts called qplot (quick plot), which in turn wrap the open source gnuplot and ghostscript utilities.
The mbtrnpp-plot.sh and trnucli-plot.sh are located in the MB-System repository here:

```
MB_SYSTEM/src/mbtrn/tools/mbtrnpp-plot
```

qplot runs on Linux, OSX and Cygwin, and requires the following packages:
 
 * bash 4+ (earlier versions do not support associative arrays)
 * gnuplot
 * ghostscript
 * libpng
 * libgd or gd2

See the README.md file for more information configuring qplot.

## Using mbtrnpp-plot and trnucli-plot

The mbtrnpp-plot (TRN instance and server) and trnucli-plot (TRN UDP client) scripts provide a set of qplot configurations and parsing code to generate a set of plots from their respective log files.
Thus, TRN performance and diagnostics may be plotted for a mission with a single command line, e.g.

```
/path/to/mbtrnpp-plot/script -v -s "/path/to/log/dir,sessionID,comment for plot sub-title"
```

where

sessionID refers to the mission timestamp reflected in the log file names:

```
mbtrnpp : yyyymmdd-hhmmss0000
trnuctx: yyyymmdd-hhmmss-<digits>-0000
```

and comment is typically a short string that will appear in the plot subtitle; it is often used to indicate mission context.


## Running mbtrnpp-plot and trnucli-plot
The basic steps to generate a plot sets include

 * copy a set of related log files to a single directory
 * optionally create a plot (output) directory
 * cd to the plot directory and run either mbtrnpp-plot.sh or trnucli-plot.sh

mbtrnpp plots require mbtrnpp and server logs:

```
mb1svr-20200905-1628040000.log
mbtrnpp-20200905-1628040000.log
trnsvr-20200905-1628040000.log
trnu-20200905-1628040000.log
trnusvr-20200905-1628040000.log
```

trnuclient plots need the client logs:

```
trnuctx-20200905-162653-560bc2a09330-0000.log
```


Each time one of the scripts is run, it generates:  

|                     |                           |
|---------------------|---------------------------|  
|       jobs directory|plot session subdirectories|
|  plot-data directory|intermediate data|
|plot-output directory|intermediate output|
|     job subdirectory|plot data, images and PDF|
|       CSV data files|for each plot parameter|
|          plot images|PNG format|
|        PDF plot file|combining all plots|

The combined plot files are named
```
mbtrnpp-comb.plot
trnucli-comb.plot
```

## Example

[run from log dir, so uses pwd]:

Tip: copy the logs to a working directory

cd /to/my/log/working/dir

/Volumes/linux-share/git/mbsys-trn/MB-System/src/mbtrn/tools/mbtrnpp-plot/mbtrnpp-plot.sh -vs "`pwd`,20200905-1628040000,Sentry563 05sep20"

/Volumes/linux-share/git/mbsys-trn/MB-System/src/mbtrn/tools/mbtrnpp-plot/trnucli-plot.sh -vs "`pwd`,20200905-172806-55d6b1e6a330-0000,Sentry563 TRN client 05sep20"

