
/* Begin user code block <abstract> */
/* End user code block <abstract> */

/**
 * README: Portions of this file are merged at file generation
 * time. Edits can be made *only* in between specified code blocks, look
 * for keywords <Begin user code> and <End user code>.
 */
/*
 * Generated by the ICS Builder Xcessory (BX).
 *
 * BuilderXcessory Version 6.1.2
 * Code Generator Xcessory 6.1.2 (07/02/03) CGX Scripts 6.1 Motif 2.1 
 *
 */


/* Begin user code block <file_comments> */
/* #define MBGRDVIZ_DEBUG 1 */
/* End user code block <file_comments> */

/*
 * Motif required Headers
 */
#include <X11/StringDefs.h>
#include <Xm/Xm.h>
#include <Xm/DialogS.h>
#include <Xm/RepType.h>
#include <Xm/MwmUtil.h>

/**
 * Globally included information.
 */


/*
 * Headers for classes used in this program
 */

/**
 * Common constant and pixmap declarations.
 */
#include "mbgrdviz_creation.h"

/**
 * Convenience functions from utilities file.
 */
extern void RegisterBxConverters(XtAppContext);
extern XtPointer BX_CONVERT(Widget, char *, char *, int, Boolean *);
extern XtPointer BX_DOUBLE(double);
extern XtPointer BX_SINGLE(float);
extern void BX_MENU_POST(Widget, XtPointer, XEvent *, Boolean *);
extern Pixmap XPM_PIXMAP(Widget, char **);
extern void BX_SET_BACKGROUND_COLOR(Widget, ArgList, Cardinal *, Pixel);

/**
 * Declarations for shell callbacks.
 */
extern void do_mbgrdviz_quit(Widget, XtPointer, XtPointer);
extern void BxExitCB(Widget, XtPointer, XtPointer);

/* Begin user code block <globals> */

#include <stdio.h>

/* MBIO include files */
#include "../../include/mb_status.h"
#include "../../include/mb_define.h"

/* mbview include file */
#include "mbview.h"

/* global mbview variables */
Widget mainWindow;

static char rcs_id[] = "$Id: mbgrdviz_main.c,v 5.2 2004-09-16 21:44:40 caress Exp $";
static char program_name[] = "MBgrdviz";
static char help_message[] =  "MBgrdviz is a simple vizualization demo for GMT grd files.";
static char usage_message[] = "mbgrdviz [-Igrdfile -V -H]";
char	ifile[MB_PATH_MAXLINE];

/* parsing variables */
extern char *optarg;
extern int optkind;
int	errflg = 0;
int	c;
int	help = 0;
int	flag = 0;

/* use these parameters only when debugging X events */
#ifdef MBGRDVIZ_DEBUG    
char	eventname[64];
XEvent	event;
XAnyEvent *xany;
XKeyEvent *xkey;
XButtonEvent *xbutton;
XMotionEvent *xmotion;
XCrossingEvent *xcrossing;
XFocusChangeEvent *xfocus;
XExposeEvent *xexpose;
XGraphicsExposeEvent *xgraphicsexpose;
XNoExposeEvent *xnoexpose;
XVisibilityEvent *xvisibility;
XCreateWindowEvent *xcreatewindow;
XDestroyWindowEvent *xdestroywindow;
XUnmapEvent *xunmap;
XMapEvent *xmap;
XMapRequestEvent *xmaprequest;
XReparentEvent *xreparent;
XConfigureEvent *xconfigure;
XGravityEvent *xgravity;
XResizeRequestEvent *xresizerequest;
XConfigureRequestEvent *xconfigurerequest;
XCirculateEvent *xcirculate;
XCirculateRequestEvent *xcirculaterequest;
XPropertyEvent *xproperty;
XSelectionClearEvent *xselectionclear;
XSelectionRequestEvent *xselectionrequest;
XSelectionEvent *xselection;
XColormapEvent *xcolormap;
XClientMessageEvent *xclient;
XMappingEvent *xmapping;
XErrorEvent *xerror;
XKeymapEvent *xkeymap;
#endif

/* End user code block <globals> */

/**
 * Change this line via the Output Application Names Dialog.
 */
#define BX_APP_CLASS "MB-System"

int main( int argc, char **argv)
{
    Widget       parent;
    XtAppContext app;
    Arg          args[256];
    Cardinal     ac;
    Boolean      argok=False;
    Widget   topLevelShell;
    Widget   mainWindow_mbgrdviz;
    
    /* Begin user code block <declarations> */
    	int	status = MB_SUCCESS;
	int	error = MB_ERROR_NO_ERROR;
	int	verbose = 0;
	int	fileflag = 0;
	int	testflag = 0;

	/* process argument list */
	while ((c = getopt(argc, argv, "VvHhI:i:Tt")) != -1)
	  {
	  switch (c) 
		{
		case 'H':
		case 'h':
			help++;
			break;
		case 'V':
		case 'v':
			verbose++;
			break;
		case 'I':
		case 'i':
			sscanf (optarg,"%s", ifile);
			flag++;
			fileflag++;
			break;
		case 'T':
		case 't':
			flag++;
			testflag++;
			break;
		case '?':
			errflg++;
		}
	    }

	/* if error flagged then print it and exit */
	if (errflg)
		{
		fprintf(stderr,"usage: %s\n", usage_message);
		fprintf(stderr,"\nProgram <%s> Terminated\n",
			program_name);
		error = MB_ERROR_BAD_USAGE;
		exit(error);
		}

	/* print starting message */
	if (verbose == 1 || help)
		{
		fprintf(stderr,"\nProgram %s\n",program_name);
		fprintf(stderr,"Version %s\n",rcs_id);
		fprintf(stderr,"MB-system Version %s\n",MB_VERSION);
		}
    
    /* End user code block <declarations> */
    
    /*
     * Initialize Xt. 
     */
    
    XtSetLanguageProc(NULL, (XtLanguageProc) NULL, NULL); 
    
    /*
     * The applicationShell is created as an unrealized
     * parent for multiple topLevelShells.  The topLevelShells
     * are created as popup children of the applicationShell.
     * This is a recommendation of Paul Asente & Ralph Swick in
     * _X_Window_System_Toolkit_ p. 677.
     */
    
    parent = XtVaOpenApplication ( &app, 
                                   BX_APP_CLASS, 
                                   NULL, 
                                   0, 
                                   &argc, 
                                   argv, 
                                   NULL, 
                                   sessionShellWidgetClass, 
                                   NULL );
    
    RegisterBxConverters(app);
    XmRepTypeInstallTearOffModelConverter();
    
    /* Begin user code block <create_shells> */
    /* End user code block <create_shells> */
    
    /*
     * Create classes and widgets used in this program. 
     */
    
    /* Begin user code block <create_topLevelShell> */
    /* End user code block <create_topLevelShell> */
    
    ac = 0;
    XtSetArg(args[ac], XmNtitle, "MBgrdviz"); ac++;
    XtSetArg(args[ac], XmNx, 108); ac++;
    XtSetArg(args[ac], XmNy, 87); ac++;
    XtSetArg(args[ac], XmNwidth, 197); ac++;
    XtSetArg(args[ac], XmNheight, 214); ac++;
    topLevelShell = XtCreatePopupShell((char *)"topLevelShell",
        topLevelShellWidgetClass,
        parent,
        args, 
        ac);
    XtAddCallback(topLevelShell, XmNdestroyCallback, do_mbgrdviz_quit, (XtPointer)0);
    XtAddCallback(topLevelShell, XmNdestroyCallback, BxExitCB, (XtPointer)0);
    mainWindow_mbgrdviz = (Widget)CreatemainWindow_mbgrdviz(topLevelShell);
    XtManageChild(mainWindow_mbgrdviz);
    XtPopup(XtParent(mainWindow_mbgrdviz), XtGrabNone);
    
    /* Begin user code block <app_procedures> */
    
    /* set top level widget */
    mainWindow = mainWindow_mbgrdviz;
    
    /* End user code block <app_procedures> */
    
    /* Begin user code block <main_loop> */
    
    /* initialize the vizualization widgets code */
    mbview_startup(verbose, parent, app, &error);
    
    /* open the file specified on the command line */
    do_mbgrdviz_init(argc,argv, verbose);
    if (fileflag > 0)
    	{
    	do_mbgrdviz_openprimary(ifile);
	}
    else if (testflag > 0)
    	{
        do_mbgrdviz_openprimary(NULL);
	}
    
    /* End user code block <main_loop> */

    /* except when debugging X events use standard function XtAppMainLoop(app) */
#ifndef MBGRDVIZ_DEBUG    
    XtAppMainLoop(app);
    
#else
    /* the following is code equivalent to XtAppMainLoop(app) that
    	prints out info regarding each event before it is dispatched */
    for (;;)
    	{
	XtAppNextEvent(app, &event);
	
	if (event.xany.type == KeyPress)
		sprintf(eventname, "KeyPress");
	else if (event.xany.type == KeyRelease)
		sprintf(eventname, "KeyRelease");
	else if (event.xany.type == ButtonPress)
		sprintf(eventname, "ButtonPress");
	else if (event.xany.type == ButtonRelease)
		sprintf(eventname, "ButtonRelease");
	else if (event.xany.type == MotionNotify)
		sprintf(eventname, "MotionNotify");
	else if (event.xany.type == EnterNotify)
		sprintf(eventname, "EnterNotify");
	else if (event.xany.type == LeaveNotify)
		sprintf(eventname, "LeaveNotify");
	else if (event.xany.type == FocusIn)
		sprintf(eventname, "FocusIn");
	else if (event.xany.type == FocusOut)
		sprintf(eventname, "FocusOut");
	else if (event.xany.type == KeymapNotify)
		sprintf(eventname, "KeymapNotify");
	else if (event.xany.type == Expose)
		sprintf(eventname, "Expose");
	else if (event.xany.type == GraphicsExpose)
		sprintf(eventname, "GraphicsExpose");
	else if (event.xany.type == NoExpose)
		sprintf(eventname, "NoExpose");
	else if (event.xany.type == VisibilityNotify)
		sprintf(eventname, "VisibilityNotify");
	else if (event.xany.type == CreateNotify)
		sprintf(eventname, "CreateNotify");
	else if (event.xany.type == DestroyNotify)
		sprintf(eventname, "DestroyNotify");
	else if (event.xany.type == UnmapNotify)
		sprintf(eventname, "UnmapNotify");
	else if (event.xany.type == MapNotify)
		sprintf(eventname, "MapNotify");
	else if (event.xany.type == MapRequest )
		sprintf(eventname, "MapRequest");
	else if (event.xany.type == ReparentNotify)
		sprintf(eventname, "ReparentNotify");
	else if (event.xany.type == ConfigureNotify)
		sprintf(eventname, "ConfigureNotify");
	else if (event.xany.type == ConfigureRequest)
		sprintf(eventname, "ConfigureRequest");
	else if (event.xany.type == GravityNotify)
		sprintf(eventname, "GravityNotify");
	else if (event.xany.type == ResizeRequest)
		sprintf(eventname, "ResizeRequest");
	else if (event.xany.type == CirculateNotify)
		sprintf(eventname, "CirculateNotify");
	else if (event.xany.type == CirculateRequest)
		sprintf(eventname, "CirculateRequest");
	else if (event.xany.type == PropertyNotify)
		sprintf(eventname, "PropertyNotify");
	else if (event.xany.type == SelectionClear)
		sprintf(eventname, "SelectionClear");
	else if (event.xany.type == SelectionRequest)
		sprintf(eventname, "SelectionRequest");
	else if (event.xany.type == SelectionNotify)
		sprintf(eventname, "SelectionNotify");
	else if (event.xany.type == ColormapNotify)
		sprintf(eventname, "ColormapNotify");
	else if (event.xany.type == ClientMessage)
		sprintf(eventname, "ClientMessage");
	else if (event.xany.type == MappingNotify)
		sprintf(eventname, "MappingNotify");

	fprintf(stderr,"Event: %s type:%d serial:%d send_event:%d display:%d window:%d\n",
	eventname, event.xany.type, event.xany.serial, event.xany.send_event, event.xany.display, event.xany.window);
	
	XtDispatchEvent(&event);
	}
#endif
    
    /*
     * A return value regardless of whether or not the main loop ends. 
     */
     return(0); 
}
